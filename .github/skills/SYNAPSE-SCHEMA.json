{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "alex-synapse-schema",
    "title": "Alex Skill Synapse Schema v2.1",
    "description": "Schema for synapses.json files in Alex skills. Schema version enables migration tooling.",
    "$comment": "Schema version 2.1.0 - February 2026. Added: inheritance field required. Breaking changes from 2.0: numeric strengths, connections array, when/yields context.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to this schema file"
        },
        "schemaVersion": {
            "type": "string",
            "description": "Schema version this file was written against (enables migration)",
            "pattern": "^\\d+\\.\\d+\\.\\d+$",
            "default": "2.0.0"
        },
        "skill": {
            "type": "string",
            "description": "Skill identifier (legacy format)"
        },
        "skillId": {
            "type": "string",
            "description": "Skill identifier (current format)"
        },
        "version": {
            "type": "string",
            "description": "Skill version in semver format",
            "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "lastValidated": {
            "type": "string",
            "description": "Date of last validation (YYYY-MM-DD)",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
        },
        "inheritance": {
            "type": "string",
            "description": "Who inherits this skill",
            "enum": [
                "inheritable",
                "master-only",
                "heir:vscode",
                "heir:m365"
            ]
        },
        "temporary": {
            "type": "boolean",
            "description": "True if skill should be removed after a milestone",
            "default": false
        },
        "removeAfter": {
            "type": "string",
            "description": "Milestone or version when to remove (e.g., 'stable-release', 'v3.7.0')"
        },
        "connections": {
            "oneOf": [
                {
                    "type": "array",
                    "description": "Legacy format: array of connection objects",
                    "items": {
                        "type": "object",
                        "properties": {
                            "target": {
                                "type": "string",
                                "description": "Target path - PREFER exact path like '.github/skills/X/SKILL.md' for LLM speed"
                            },
                            "type": {
                                "type": "string",
                                "description": "Relationship type"
                            },
                            "strength": {
                                "type": "number",
                                "description": "Connection weight (0.0-1.0)",
                                "minimum": 0,
                                "maximum": 1
                            },
                            "when": {
                                "type": "string",
                                "description": "LLM action trigger: WHEN to follow this synapse (e.g., 'converting FROM svg', 'after creating banner')"
                            },
                            "yields": {
                                "type": "string",
                                "description": "LLM decision hint: WHAT you'll find there (e.g., 'SVG patterns, dark mode', 'sharp-cli commands')"
                            },
                            "bidirectional": {
                                "type": "boolean",
                                "description": "If true, connection goes both ways (<-->)",
                                "default": false
                            },
                            "weak": {
                                "type": "boolean",
                                "description": "If true, renders as dashed line (-.->)",
                                "default": false
                            }
                        },
                        "required": [
                            "target",
                            "type",
                            "strength"
                        ]
                    }
                },
                {
                    "type": "object",
                    "description": "Current format: object with skill names as keys",
                    "additionalProperties": {
                        "type": "object",
                        "properties": {
                            "weight": {
                                "type": "number",
                                "description": "Connection weight (0.0-1.0)",
                                "minimum": 0,
                                "maximum": 1
                            },
                            "relationship": {
                                "type": "string",
                                "description": "Type of relationship"
                            },
                            "reason": {
                                "type": "string",
                                "description": "Why this connection exists"
                            },
                            "bidirectional": {
                                "type": "boolean",
                                "description": "If true, connection goes both ways (<-->)",
                                "default": false
                            },
                            "weak": {
                                "type": "boolean",
                                "description": "If true, renders as dashed line (-.->)",
                                "default": false
                            }
                        },
                        "required": [
                            "weight",
                            "relationship"
                        ]
                    }
                }
            ]
        },
        "activationBoost": {
            "type": "array",
            "description": "Legacy format: keywords that boost activation",
            "items": {
                "type": "string"
            }
        },
        "activationContexts": {
            "type": "array",
            "description": "Current format: contexts that activate this skill",
            "items": {
                "type": "string"
            }
        },
        "notes": {
            "type": "string",
            "description": "Additional notes about the skill"
        }
    },
    "anyOf": [
        {
            "required": [
                "skill",
                "inheritance"
            ]
        },
        {
            "required": [
                "skillId",
                "inheritance"
            ]
        }
    ]
}
